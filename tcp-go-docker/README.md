English：

The current code has implemented NAT traversal based on TCP (simulation experiment).

1. Run `go mod tidy` in the directory first.
2. Build the project by running `go build` in the directory.
3. Run the relay server: `./hp s :9999`.
4. Run the clients (two clients): `./hp c 192.168.31.114:9999`
   (where `192.168.31.114:9999` is the IP address and port of the relay server).

======================================
Running in a Docker environment:

1. Install Docker first.
2. Navigate to the current directory and execute `docker-compose up`.

======================================
Modify Docker network environment:

1. Modify the bandwidth, RTT, and packet loss rate by running the following commands in the `docker-compose.yml` file:
   1. `tc qdisc add dev eth0 root handle 1: tbf rate 10mbit latency 50ms burst 10kb && \`
   2. `tc qdisc add dev eth0 parent 1:1 handle 10: netem loss 10% && \`
   3. `tc qdisc add dev eth0 parent 10: handle 20: netem delay 10ms && \`
2. You can modify the above environment according to your requirements.

======================================

Run the script to collect TCP punching data:

1. To execute multiple tests (the script defaults to 100 times), simply run the command `./docker_finish.sh` in the current directory.
2. To modify the number of executions, change the number "100" in the `for i in {1..100}` loop.
3. The data generated by running the script is saved in the `log_info.csv` file.

======================================
After collecting the data, use Python for analysis (see the `analyze_fin` file).

# ==================================

中文：

当前代码已经实现基于 TCP 的 NAT 穿透（模拟实验）
go 版本要 1.20 以上

1. 先在文件下运行 `go mod tidy`
2. 在文件下运行 `go build`
3. 在中继服务器运行： `./hp s :9999`
4. 在客户端（两个客户端）都运行： `./hp c 192.168.31.114:9999`
   （`192.168.31.114:9999`为中继服务器的 IP 地址和端口）

======================================

在 docke 环境中运行

1. 先安装 docker
2. 进入到当前目录，执行 `docker-compose up`

=====================================

修改 docker 网络环境

1. 当前运行修改 带宽、RTT、丢包率（在 docker-compose.yml 文件中）

   1. `tc qdisc add dev eth0 root handle 1: tbf rate 10mbit latency 50ms burst 10kb && \`
   2. `tc qdisc add dev eth0 parent 1:1 handle 10: netem loss 10% && \`
   3. `tc qdisc add dev eth0 parent 10: handle 20: netem delay 10ms && \`

2. 可以根据需求修改上述环境

=====================================

运行脚本收集 TCP 打洞数据

1. 若要执行多次测试（脚本默认 100 次），直接到当前目录执行命令：./docker_finish.sh
2. 若要修改执行次数，修改 for i in {1..100} 中的数字“100”即可
3. 运行脚本生成的数据保存在 log_info.csv 文件中

=====================================

收集完数据，使用 python 分析，见文件【analyze_fin】
